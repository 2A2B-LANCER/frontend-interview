### 回调函数

> In JavaScript, functions are first-class objects

因为**“函数在JavaScript中是一等公民”**，所以**函数可以作为参数被传递**给另一个函数，然后执行传入的参数，甚至返回它以供稍后执行。这就是回调函数的本质

> 回调函数：也被称为高阶函数，是指将函数作为参数传递给另一个函数（otherFunction），并在otherFunction内部执行回调函数

```javascript
// jQuery 常用用法
$("#btn_1").click(function() {
  alert("Btn 1 Clicked");
});

// 原生 JS 常用用法
var friends = ["Mike", "Stacy", "Andy", "Rick"];

friends.forEach(function (eachName, index){
console.log(index + 1 + ". " + eachName); // 1. Mike, 2. Stacy, 3. Andy, 4. Rick
});
```

#### 回调函数如何工作

当一个回调函数被当作参数传递给另一个函数（otherFunction）的时候，我们只是传递了回调函数的**定义**，并没有在这个过程中执行回调函数；正是因为回调函数会在 otherFunction 内的某个点执行，才会被叫做**回调函数**

#### 实现回调函数的基本原则

1. 使用具名、匿名、箭头函数作为回调函数
2. 可以给回调函数传递参数
3. 在执行回调函数之前确保它是个函数
4. 当回调函数中使用了 `this` 的时候，一定要确保 `this` 绑定到了你想绑定的对象上

```javascript
var clientData = {
    id: 094545,
    setUserName: function (firstName, lastName)  {
      this.fullName = firstName + " " + lastName;
    }
}
function getUserInput(firstName, lastName, callback)  {
    callback (firstName, lastName);
}
function getUser(firstName, lastName, callback, callbackObj)  {
    callback.apply (callbackObj, [firstName, lastName]);
}
getUserInput ("Barack", "Obama", clientData.setUserName);
console.log (clientData.fullName);// undefined
console.log (window.fullName); // Barack Obama

getUserInput ("Barack", "Obama", clientData.setUserName, clientData);
console.log (clientData.fullName);// Barack Obama
```

5. 允许多个回调函数

#### 可能出现的问题

1. 回调地狱
2. 控制反转：回调函数中的代码是我们希望程序在某个节点之后执行的代码，但是代码什么时候执行？执行几次，我们都无从得知，这样控制权就被交到了第三方手里，这就叫做控制反转

### Promise

在 `JavaScript` 中，如果我们想要在某个函数执行结束（某个点）的时候得到通知，去做一些事情，这个函数什么时候结束我不需要知道，那我们以往会怎么做呢？

上面这段描述不就是回调函数吗，但是回调函数有着缺乏顺序性和可信任性的问题，`Promise` 应运而生

使用 `Promise` 当到了 **未来的某一刻** 之后，那个 **未来某一时刻产生的值** 会被 `Promise` 收集到，接着去做想做的事（即以前在回调函数中做的事）

我理解的反控制反转就是：回调函数不再需要参与到包含函数的执行当中去，监听程序（第三方协商机制）获取到了想要的东西之后传递给回调函数（监听处理程序），那这种情况下，包含函数和回调函数的耦合度降低了，回调函数的执行权也回到了我们自己的手里，所以就实现了反控制反转。

### event loop

```javascript
alert("1")
setTimeout(alert, 0, "2");
new Promise((resolve, reject) => {
    alert("6");
    resolve();
}).then(() => {alert("3")}).then(() => {alert("5")})
alert("4")
```



### 生成器和迭代器

### async await